<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mtaa Store — Demo</title>
  <style>
    :root{--accent:#111;--muted:#666}
    body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:#f4f6f8;color:#111}
    header{background:#fff}
    .banner-container{position:relative;height:260px;overflow:hidden}
    .banner-slide{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .8s}
    .banner-slide.active{opacity:1}
    .site{max-width:1200px;margin:18px auto;padding:0 16px}
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .logo{font-weight:700;font-size:20px}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px}
    .card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(15,15,15,0.06)}
    .card img{width:100%;height:160px;object-fit:cover;border-radius:8px}
    .btn{display:inline-block;padding:10px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer}

    /* Admin panel */
    .admin-bar{position:fixed;right:18px;bottom:18px;background:#222;color:#fff;padding:10px 12px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,0.25);z-index:60}
    .drawer{position:fixed;right:0;top:0;height:100%;width:480px;background:#fff;box-shadow:-12px 0 40px rgba(8,8,8,0.12);transform:translateX(100%);transition:transform .3s;z-index:80;padding:18px;overflow:auto}
    .drawer.open{transform:translateX(0)}
    .field{margin:8px 0}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text],input[type=number],textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ee}
    .small{font-size:13px;color:var(--muted)}
    footer{padding:18px;text-align:center;color:var(--muted)}

    @media(max-width:640px){.drawer{width:100%}}
  </style>
</head>
<body>

<header>
  <div class="banner-container" id="bannerContainer">
    <!-- banners populated by JS -->
  </div>
</header>

<main class="site">
  <div class="topbar">
    <div class="logo">Mtaa Store</div>
    <div>
      <button class="btn" id="openCart">Cart (<span id="cartCount">0</span>)</button>
    </div>
  </div>

  <section>
    <h2>Products</h2>
    <div class="grid" id="productGrid">
      <!-- products populated by JS -->
    </div>
  </section>

  <section style="margin-top:24px">
    <h3>Checkout (demo)</h3>
    <div class="card">
      <p class="small">Choose a payment method. For production you will need server-side endpoints connected to the mobile money providers (examples included in admin panel).</p>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" id="payMpesa">Pay with M-PESA</button>
        <button class="btn" id="payAirtel">Airtel Money</button>
        <button class="btn" id="payTigo">TigoPesa</button>
      </div>
    </div>
  </section>

  <footer>
    © 2025 Mtaa Store — Demo
  </footer>
</main>

<!-- Admin floating button -->
<div class="admin-bar">
  <button id="toggleAdmin" style="background:transparent;border:0;color:#fff;cursor:pointer;font-weight:600">Admin</button>
</div>

<!-- Admin drawer -->
<div class="drawer" id="adminDrawer" aria-hidden="true">
  <h2>Admin — Banners & Products</h2>
  <p class="small">This demo stores data in <strong>localStorage</strong> and calls demo server endpoints when you click "Save to server". Replace the endpoints with your production server URL.</p>

  <hr />
  <h3>Banners</h3>
  <div id="bannersList"></div>
  <div style="margin-top:8px" class="card">
    <div class="field"><label>Image URL</label><input id="bannerUrl" type="text" placeholder="https://..." /></div>
    <div class="field"><label>Alt / Caption</label><input id="bannerAlt" type="text" /></div>
    <div style="display:flex;gap:8px"><button class="btn" id="addBanner">Add Banner</button><button class="btn" id="saveBanners">Save to server</button></div>
  </div>

  <hr />
  <h3>Products</h3>
  <div id="productsList"></div>
  <div style="margin-top:8px" class="card">
    <div class="field"><label>Title</label><input id="pTitle" type="text" /></div>
    <div class="field"><label>Price (USD)</label><input id="pPrice" type="number" /></div>
    <div class="field"><label>Image URL</label><input id="pImage" type="text" /></div>
    <div class="field"><label>Description</label><textarea id="pDesc"></textarea></div>
    <div style="display:flex;gap:8px"><button class="btn" id="addProduct">Add Product</button><button class="btn" id="saveProducts">Save to server</button></div>
  </div>

  <hr />
  <h3>Server & Payment Integration (samples)</h3>
  <p class="small">Below are example server endpoints (Node/Express) and notes for connecting to M-PESA (Daraja), Airtel/TigoPesa. Use the provider developer portals to register and get sandbox/production keys.</p>

  <pre style="background:#f6f7f9;padding:10px;border-radius:8px;overflow:auto;font-size:13px">// Node/Express (example)
const express = require('express');
const axios = require('axios');
const app = express();
app.use(express.json());

// Save products/banners (simple example)
app.post('/api/save/products', (req, res) => { /* save to DB */ res.json({ok:true}) });
app.post('/api/save/banners', (req, res) => { /* save to DB */ res.json({ok:true}) });

// M-PESA (Daraja) example: create STK push (customer will enter PIN on phone)
app.post('/api/pay/mpesa', async (req, res) => {
  // you need consumerKey, consumerSecret from Safaricom Daraja portal
  // 1) Get access token
  // 2) Call /mpesa/stkpush/v1/processrequest with required fields (BusinessShortCode, Password, Timestamp, Amount, PartyA (customer MSISDN), PartyB, PhoneNumber, CallBackURL, AccountReference, TransactionDesc)
  res.json({status:'mocked', details:req.body});
});

// Airtel Money & TigoPesa: partner APIs vary by country — many businesses use a payment aggregator (ClickPesa, DPO, Tola) to simplify integration.
app.post('/api/pay/airtel', async (req,res)=>{ res.json({status:'mocked',details:req.body}) });
app.post('/api/pay/tigo', async (req,res)=>{ res.json({status:'mocked',details:req.body}) });

app.listen(3000);
</pre>

  <p class="small"><strong>Helpful links:</strong> Safaricom Daraja docs, Airtel Africa developer portal, TigoPesa partner docs (links provided in the admin notes).</p>

  <div style="margin-top:18px;display:flex;gap:8px"><button class="btn" id="closeAdmin">Close</button></div>
</div>

<script>
// ---------- Frontend demo logic (stores to localStorage) ----------
const defaultBanners = [
  {url:'https://via.placeholder.com/1200x300?text=Banner+1',alt:'Banner 1'},
  {url:'https://via.placeholder.com/1200x300?text=Banner+2',alt:'Banner 2'},
  {url:'https://via.placeholder.com/1200x300?text=Banner+3',alt:'Banner 3'},
];
const defaultProducts = [
  {id:crypto.randomUUID(),title:'Product 1',price:10,desc:'Nice item',image:'https://via.placeholder.com/400?text=Product+1'},
  {id:crypto.randomUUID(),title:'Product 2',price:15,desc:'Nice item',image:'https://via.placeholder.com/400?text=Product+2'},
];

// helpers
function read(key, fallback){try{return JSON.parse(localStorage.getItem(key))||fallback}catch(e){return fallback}}
function write(key,val){localStorage.setItem(key,JSON.stringify(val))}

let banners = read('mtaa_banners', defaultBanners);
let products = read('mtaa_products', defaultProducts);
let cart = read('mtaa_cart', []);

// Banner renderer
const bannerContainer = document.getElementById('bannerContainer');
function renderBanners(){bannerContainer.innerHTML = '';banners.forEach((b,i)=>{const img=document.createElement('img');img.src=b.url;img.alt=b.alt||'';img.className='banner-slide '+(i===0?'active':'');bannerContainer.appendChild(img)})}
renderBanners();
let bIndex=0;setInterval(()=>{const slides=document.querySelectorAll('.banner-slide');slides.forEach((s,i)=>s.classList.toggle('active',i===bIndex));bIndex=(bIndex+1)%slides.length},3000)

// Products
const productGrid = document.getElementById('productGrid');
function renderProducts(){productGrid.innerHTML='';products.forEach(p=>{const d=document.createElement('div');d.className='card';d.innerHTML=`<img src="${p.image}" alt=""><h4>${p.title}</h4><p class="small">${p.desc}</p><p><strong>$${p.price}</strong></p><button class="btn" data-id="${p.id}">Add to cart</button>`;productGrid.appendChild(d)})}
renderProducts();

// Cart
function updateCartCount(){document.getElementById('cartCount').textContent=cart.length}
updateCartCount();
productGrid.addEventListener('click',e=>{if(e.target.matches('button.btn')){const id=e.target.dataset.id;const p=products.find(x=>x.id===id);cart.push(p);write('mtaa_cart',cart);updateCartCount();alert('Added to cart')}})

// Payment demo: these calls POST to server endpoints — implement server as shown in admin notes
async function demoPay(provider){const payload={provider,amount:cart.reduce((s,i)=>s+i.price,0),items:cart};
  try{const r=await fetch('/api/pay/'+provider,{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(payload)});const j=await r.json();alert('Server response: '+JSON.stringify(j))}catch(err){alert('Failed to call server endpoint. See admin panel for server sample.')}}

document.getElementById('payMpesa').addEventListener('click',()=>demoPay('mpesa'))
document.getElementById('payAirtel').addEventListener('click',()=>demoPay('airtel'))
document.getElementById('payTigo').addEventListener('click',()=>demoPay('tigo'))

// Admin drawer controls
const adminDrawer=document.getElementById('adminDrawer');
const toggleAdmin=document.getElementById('toggleAdmin');
const closeAdmin=document.getElementById('closeAdmin');
function openAdmin(){adminDrawer.classList.add('open');renderAdminLists()}
function closeAdminFn(){adminDrawer.classList.remove('open')}
toggleAdmin.onclick=openAdmin;closeAdmin.onclick=closeAdminFn

// banners admin
const bannersList=document.getElementById('bannersList');
function renderAdminLists(){
  // banners
  bannersList.innerHTML='';banners.forEach((b,i)=>{const el=document.createElement('div');el.className='card';el.style.marginBottom='8px';el.innerHTML=`<strong>${b.alt||('Banner '+(i+1))}</strong><div class="small">${b.url}</div><div style="margin-top:6px"><button data-i="${i}" class="btn editBanner">Edit</button> <button data-i="${i}" class="btn delBanner">Delete</button></div>`;bannersList.appendChild(el)})
  // products
  const productsList=document.getElementById('productsList');productsList.innerHTML='';products.forEach((p,idx)=>{const el=document.createElement('div');el.className='card';el.style.marginBottom='8px';el.innerHTML=`<strong>${p.title}</strong><div class="small">$${p.price} — ${p.desc}</div><div style="margin-top:6px"><button data-id="${p.id}" class="btn editProduct">Edit</button> <button data-id="${p.id}" class="btn delProduct">Delete</button></div>`;productsList.appendChild(el)})
}

bannersList.addEventListener('click',e=>{if(e.target.matches('.delBanner')){const i=+e.target.dataset.i;banners.splice(i,1);write('mtaa_banners',banners);renderBanners();renderAdminLists()} if(e.target.matches('.editBanner')){const i=+e.target.dataset.i;const url=prompt('New URL',banners[i].url);const alt=prompt('New alt',banners[i].alt);if(url){banners[i]={url,alt};write('mtaa_banners',banners);renderBanners();renderAdminLists()}}})

// add banner
document.getElementById('addBanner').addEventListener('click',()=>{const url=document.getElementById('bannerUrl').value;const alt=document.getElementById('bannerAlt').value;if(!url){alert('Image URL required');return}banners.push({url,alt});write('mtaa_banners',banners);renderBanners();renderAdminLists();document.getElementById('bannerUrl').value='';document.getElementById('bannerAlt').value=''});

// products admin
const productsListEl=document.getElementById('productsList');
productsListEl.addEventListener('click',async e=>{if(e.target.matches('.delProduct')){const id=e.target.dataset.id;products=products.filter(p=>p.id!==id);write('mtaa_products',products);renderProducts();renderAdminLists()} if(e.target.matches('.editProduct')){const id=e.target.dataset.id;const p=products.find(x=>x.id===id);const title=prompt('Title',p.title);const price=prompt('Price',p.price);const image=prompt('Image URL',p.image);const desc=prompt('Desc',p.desc);if(title){Object.assign(p,{title,price:+price,image,desc});write('mtaa_products',products);renderProducts();renderAdminLists()}}})

document.getElementById('addProduct').addEventListener('click',()=>{const title=document.getElementById('pTitle').value;const price=+document.getElementById('pPrice').value;const image=document.getElementById('pImage').value;const desc=document.getElementById('pDesc').value;if(!title||!price){alert('Title and price required');return}const item={id:crypto.randomUUID(),title,price,desc,image};products.push(item);write('mtaa_products',products);renderProducts();renderAdminLists();document.getElementById('pTitle').value='';document.getElementById('pPrice').value='';document.getElementById('pImage').value='';document.getElementById('pDesc').value='';})

// Save to server (demo)
document.getElementById('saveProducts').addEventListener('click',async()=>{try{await fetch('/api/save/products',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(products)});alert('Products saved (mocked)')}catch(e){alert('Failed to save — implement server endpoint as shown in admin notes.')}})

document.getElementById('saveBanners').addEventListener('click',async()=>{try{await fetch('/api/save/banners',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(banners)});alert('Banners saved (mocked)')}catch(e){alert('Failed to save — implement server endpoint as shown in admin notes.')}})

// initialize admin lists when first opened
function ensureInit(){if(!localStorage.getItem('mtaa_banners')) write('mtaa_banners',banners); else banners=read('mtaa_banners',banners);
  if(!localStorage.getItem('mtaa_products')) write('mtaa_products',products); else products=read('mtaa_products',products);
}
ensureInit();

</script>

</body>
</html>
